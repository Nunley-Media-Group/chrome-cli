# Design: Cargo Workspace Setup

**Issue**: #1
**Date**: 2026-02-10
**Status**: Draft
**Author**: Claude (spec-driven)

---

## Overview

This is a project scaffolding task — no application logic, no external dependencies beyond the Rust standard library. The deliverable is a set of configuration files and a minimal `src/main.rs` that establishes the project foundation.

The project starts as a single crate (not a multi-member workspace). `Cargo.toml` uses `[workspace]` configuration so it's ready for future crate splits, but initially contains only the root package. Edition 2024 and resolver 3 are used per issue requirements.

---

## Architecture

### Project Layout

```
chrome-cli/
├── Cargo.toml            # Workspace + package config, clippy lints
├── Cargo.lock             # Generated by cargo build
├── LICENSE-MIT            # MIT license text
├── LICENSE-APACHE         # Apache 2.0 license text
├── README.md              # Scaffold with project name + under construction
├── .gitignore             # Rust-specific ignores
├── rustfmt.toml           # Formatting rules
├── rust-toolchain.toml    # Pinned stable toolchain
└── src/
    └── main.rs            # Minimal entry point, prints version
```

### Data Flow

Not applicable — this is project scaffolding only. The `main.rs` simply prints version info and exits.

---

## File Specifications

### Cargo.toml

Single file combining `[workspace]` and `[package]` sections:

```toml
[workspace]
resolver = "3"

[package]
name = "chrome-cli"
version = "0.1.0"
edition = "2024"
authors = ["rnunley"]
license = "MIT OR Apache-2.0"
repository = "https://github.com/rnunley-nmg/chrome-cli"
description = "Browser automation and inspection CLI via Chrome DevTools Protocol"
keywords = ["chrome", "devtools", "cdp", "cli", "automation"]
categories = ["command-line-utilities", "development-tools", "web-programming"]

[lints.clippy]
all = { level = "deny", priority = -1 }
pedantic = { level = "warn", priority = -1 }
```

**Rationale**: Using `[lints.clippy]` in Cargo.toml (stable since Rust 1.74) is preferred over a separate `clippy.toml` — it keeps lint config with the package definition and is recognized by `cargo clippy` natively.

### src/main.rs

Minimal binary that prints version information. Uses `env!` macros to pull version from Cargo.toml at compile time:

```rust
fn main() {
    let name = env!("CARGO_PKG_NAME");
    let version = env!("CARGO_PKG_VERSION");
    println!("{name} {version}");
}
```

**Note**: This is intentionally not using clap yet — issue #3 adds the CLI skeleton with clap. A simple `println!` is sufficient for AC7.

### rust-toolchain.toml

```toml
[toolchain]
channel = "1.85.0"
```

**Rationale**: Rust 1.85.0 is the first stable release supporting edition 2024. Pin to this as the minimum required version.

### rustfmt.toml

```toml
edition = "2024"
```

**Rationale**: Keep formatting config minimal. The Rust community default style is well-established; only override the edition to match the project.

### .gitignore

Standard Rust `.gitignore` covering:
- `target/` (build artifacts)
- Editor temps (`*.swp`, `*~`, `.idea/`, `.vscode/`)
- OS files (`.DS_Store`, `Thumbs.db`)

### License Files

- `LICENSE-MIT`: Standard MIT license text with copyright holder
- `LICENSE-APACHE`: Full Apache License 2.0 text

### README.md

Minimal scaffold:
- Project name as heading
- One-line description
- "Under construction" notice
- License mention

---

## Alternatives Considered

| Option | Description | Pros | Cons | Decision |
|--------|-------------|------|------|----------|
| **A: Multi-crate workspace** | Split into `chrome-cli` and `chrome-cli-core` from the start | Clean separation early | Premature — no code to separate yet | Rejected — split when needed |
| **B: Single crate with workspace ready** | One package, `[workspace]` section for future use | Simple start, easy to split later | Slightly more in Cargo.toml | **Selected** |
| **C: clippy.toml** | Separate file for clippy config | Separation of concerns | Extra file; `[lints.clippy]` in Cargo.toml is now standard | Rejected — use Cargo.toml |

---

## Security Considerations

Not applicable for project scaffolding.

---

## Performance Considerations

Not applicable for project scaffolding.

---

## Testing Strategy

| Layer | Type | Coverage |
|-------|------|----------|
| Build | Smoke | `cargo build` succeeds with zero warnings |
| Lint | Smoke | `cargo clippy -- -D warnings` passes |
| Format | Smoke | `cargo fmt --check` passes |
| Test | Smoke | `cargo test` passes |

For this scaffolding issue, the "tests" are the build/lint/format verification commands themselves. No unit tests are needed yet.

---

## Risks & Mitigations

| Risk | Likelihood | Impact | Mitigation |
|------|------------|--------|------------|
| Edition 2024 not supported by installed toolchain | Low | High | rust-toolchain.toml pins minimum version; CI will install correct version |
| Resolver 3 not available | Low | High | Resolver 3 requires Rust 1.84+; pinned toolchain covers this |

---

## Open Questions

- None

---

## Validation Checklist

- [x] Architecture follows Rust ecosystem conventions
- [x] All configuration files documented with rationale
- [x] Alternatives were considered and documented
- [x] Risks identified with mitigations
- [x] Testing strategy defined
