# File: tests/features/dialog-timeout-fix.feature
#
# Generated from: .claude/specs/86-fix-dialog-commands-timeout-with-open-dialog/requirements.md
# Issue: #86
# Type: Defect regression

@regression
Feature: Dialog commands work when a dialog is already open
  The dialog info and dialog handle commands previously timed out on
  Page.enable when a JavaScript dialog was already open, making them
  non-functional in their primary use case.
  This was fixed by skipping blocking domain enablement in dialog commands.

  # --- Bug Is Fixed ---

  @regression
  Scenario: AC1 — dialog info works with open alert dialog
    Given Chrome is running with a page loaded
    And a JavaScript alert dialog is open with message "test"
    When I run "chrome-cli dialog info --pretty"
    Then the output contains "open": true
    And the output contains "type": "alert"
    And the output contains "message": "test"
    And the exit code should be 0

  @regression
  Scenario: AC2 — dialog handle accept works with open alert dialog
    Given Chrome is running with a page loaded
    And a JavaScript alert dialog is open with message "test"
    When I run "chrome-cli dialog handle accept --pretty"
    Then the output contains "action": "accept"
    And the dialog is dismissed
    And the exit code should be 0

  @regression
  Scenario: AC3 — dialog handle dismiss works with open confirm dialog
    Given Chrome is running with a page loaded
    And a JavaScript confirm dialog is open with message "Are you sure?"
    When I run "chrome-cli dialog handle dismiss --pretty"
    Then the output contains "action": "dismiss"
    And the dialog is dismissed
    And the exit code should be 0

  @regression
  Scenario: AC4 — dialog handle accept with text works for prompt dialog
    Given Chrome is running with a page loaded
    And a JavaScript prompt dialog is open with message "Enter name:"
    When I run "chrome-cli dialog handle accept --text "answer" --pretty"
    Then the output contains "action": "accept"
    And the output contains "text": "answer"
    And the dialog is dismissed
    And the exit code should be 0

  # --- Related Behavior Still Works ---

  @regression
  Scenario: AC5 — dialog info still reports no dialog when none is open
    Given Chrome is running with a page loaded
    And no JavaScript dialog is open
    When I run "chrome-cli dialog info"
    Then the output contains "open": false
    And the exit code should be 0

  @regression
  Scenario: AC6 — dialog handle still errors when no dialog is open
    Given Chrome is running with a page loaded
    And no JavaScript dialog is open
    When I run "chrome-cli dialog handle accept"
    Then the exit code should be non-zero
    And the output contains an error about no dialog being open
